\doxysection{Report\+Snapshot Namespace Reference}
\hypertarget{namespace_report_snapshot}{}\label{namespace_report_snapshot}\index{ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespace_report_snapshot_a4038a78dd7952cb6dfbbdfa6beb24fca}{read\+\_\+report\+\_\+csv}} (filename, chunk)
\item 
\mbox{\hyperlink{namespace_report_snapshot_a0a15f5df30b9169ee9e6c75baf35dc38}{group\+\_\+by\+\_\+field}} (data, fields, snapshot)
\item 
\mbox{\hyperlink{namespace_report_snapshot_a98e6f1f0b14bea0bdb8bd9c1b11a187d}{build\+\_\+snapshot}} (df, field, snapshot)
\item 
\mbox{\hyperlink{namespace_report_snapshot_a402838bb70b79753510e72c4a34fc154}{upload\+\_\+mongo}} (event, final\+\_\+path, snapshot, period)
\item 
\mbox{\hyperlink{namespace_report_snapshot_ab4de627686be8f3a33a079e7e7e60520}{create\+\_\+snapshot}} (event, final\+\_\+path)
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespace_report_snapshot_a3d2d63b5a76762a3a9d446f2020ebfe4}{f\+\_\+path}} = \+\_\+\+\_\+file\+\_\+\+\_\+
\item 
\mbox{\hyperlink{namespace_report_snapshot_a493ebf6121b88a8b629ddb60e498f503}{index}} = f\+\_\+path.\+find("{}report\+\_\+generation/"{})
\item 
\mbox{\hyperlink{namespace_report_snapshot_a59583ca70cb2351f5ddbd468db13ee24}{ACCESS\+\_\+\+ID}}
\begin{DoxyCompactList}\small\item\em Access keys for AWS. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespace_report_snapshot_a4c418fb519cd241f4820beb3d4c1b3e3}{ACCESS\+\_\+\+KEY}}
\begin{DoxyCompactList}\small\item\em Access keys for AWS. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespace_report_snapshot_a656392c6261d12e0cdfeb2dac6d382e0}{mongo\+\_\+conn}} = mongo\+\_\+connection()
\begin{DoxyCompactList}\small\item\em Class to connect to mongodb. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespace_report_snapshot_a934e21a368825fb600d7d4ffe7631953}{snap\+\_\+collection}} = mongo\+\_\+conn.\+mongo\+\_\+conn\+\_\+snapshots()
\begin{DoxyCompactList}\small\item\em Mongo collection to create/update snapshots. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespace_report_snapshot_a9708b903819d920a4553e277f2f2290b}{final\+\_\+df}} = Data\+Frame()
\item 
int \mbox{\hyperlink{namespace_report_snapshot_a60747d9e82279ba6a019e6e737f66ca0}{total\+\_\+rows}} = 0
\item 
int \mbox{\hyperlink{namespace_report_snapshot_a5076344f8f3c921e9d877dad90a54a84}{total\+\_\+local}} = 0
\item 
\mbox{\hyperlink{namespace_report_snapshot_a24e32d77f91c807604150367b99c10a7}{session}} = boto3.\+Session(aws\+\_\+access\+\_\+key\+\_\+id=\mbox{\hyperlink{namespace_report_snapshot_a59583ca70cb2351f5ddbd468db13ee24}{ACCESS\+\_\+\+ID}}, aws\+\_\+secret\+\_\+access\+\_\+key= \mbox{\hyperlink{namespace_report_snapshot_a4c418fb519cd241f4820beb3d4c1b3e3}{ACCESS\+\_\+\+KEY}})
\begin{DoxyCompactList}\small\item\em Connection for AWS using boto3. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespace_report_snapshot_ad1d92ff734086f7f9a1d42f5ae674f59}{update\+\_\+at}} = dt.\+now().replace(hour=0, minute=0, second=0, microsecond=0)
\begin{DoxyCompactList}\small\item\em It\textquotesingle{}s used to know when snapshot was created/updated. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\Hypertarget{namespace_report_snapshot_a98e6f1f0b14bea0bdb8bd9c1b11a187d}\label{namespace_report_snapshot_a98e6f1f0b14bea0bdb8bd9c1b11a187d} 
\index{ReportSnapshot@{ReportSnapshot}!build\_snapshot@{build\_snapshot}}
\index{build\_snapshot@{build\_snapshot}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{build\_snapshot()}{build\_snapshot()}}
{\footnotesize\ttfamily Report\+Snapshot.\+build\+\_\+snapshot (\begin{DoxyParamCaption}\item[{}]{df,  }\item[{}]{field,  }\item[{}]{snapshot }\end{DoxyParamCaption})}

\begin{DoxyVerb}Checks the field and fill the snapshot field using grouped data.

Args:
    df (pandas dataframe): current parquet file loaded as dataframe
    field (str): current file used as filter
    snapshot (dict): it will contain all fields info
Returns: snapshot (dict)
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00068}{68}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

Here is the caller graph for this function\+:
% FIG 0
\Hypertarget{namespace_report_snapshot_ab4de627686be8f3a33a079e7e7e60520}\label{namespace_report_snapshot_ab4de627686be8f3a33a079e7e7e60520} 
\index{ReportSnapshot@{ReportSnapshot}!create\_snapshot@{create\_snapshot}}
\index{create\_snapshot@{create\_snapshot}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{create\_snapshot()}{create\_snapshot()}}
{\footnotesize\ttfamily Report\+Snapshot.\+create\+\_\+snapshot (\begin{DoxyParamCaption}\item[{}]{event,  }\item[{}]{final\+\_\+path }\end{DoxyParamCaption})}

\begin{DoxyVerb}Executes full procedure

Args:
    event (dict): contains the file and client info
    final_path (str): Path where original csv is saved in s3
Returns: Nothing
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00126}{126}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

Here is the call graph for this function\+:
% FIG 1
\Hypertarget{namespace_report_snapshot_a0a15f5df30b9169ee9e6c75baf35dc38}\label{namespace_report_snapshot_a0a15f5df30b9169ee9e6c75baf35dc38} 
\index{ReportSnapshot@{ReportSnapshot}!group\_by\_field@{group\_by\_field}}
\index{group\_by\_field@{group\_by\_field}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{group\_by\_field()}{group\_by\_field()}}
{\footnotesize\ttfamily Report\+Snapshot.\+group\+\_\+by\+\_\+field (\begin{DoxyParamCaption}\item[{}]{data,  }\item[{}]{fields,  }\item[{}]{snapshot }\end{DoxyParamCaption})}

\begin{DoxyVerb}Group by service_id, territory_code, artists and tracks

Args:
    data (pandas dataframe): current parquet file loaded as dataframe
    fields (list): list of fields that are considered to snapshot
    snapshot (dict): it will contain all fields info
Returns: snap (dict)
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00053}{53}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

Here is the call graph for this function\+:
% FIG 2
Here is the caller graph for this function\+:
% FIG 3
\Hypertarget{namespace_report_snapshot_a4038a78dd7952cb6dfbbdfa6beb24fca}\label{namespace_report_snapshot_a4038a78dd7952cb6dfbbdfa6beb24fca} 
\index{ReportSnapshot@{ReportSnapshot}!read\_report\_csv@{read\_report\_csv}}
\index{read\_report\_csv@{read\_report\_csv}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{read\_report\_csv()}{read\_report\_csv()}}
{\footnotesize\ttfamily Report\+Snapshot.\+read\+\_\+report\+\_\+csv (\begin{DoxyParamCaption}\item[{}]{filename,  }\item[{}]{chunk }\end{DoxyParamCaption})}

\begin{DoxyVerb}Receives a S3 path and loads the data using awswrangler ans chunks (1M lines per chunk)

Args:
    filename (str): s3 file location
    chunk (int): chunk size
Returns: final_df (pandas dataframe)
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00035}{35}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

Here is the caller graph for this function\+:
% FIG 4
\Hypertarget{namespace_report_snapshot_a402838bb70b79753510e72c4a34fc154}\label{namespace_report_snapshot_a402838bb70b79753510e72c4a34fc154} 
\index{ReportSnapshot@{ReportSnapshot}!upload\_mongo@{upload\_mongo}}
\index{upload\_mongo@{upload\_mongo}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{upload\_mongo()}{upload\_mongo()}}
{\footnotesize\ttfamily Report\+Snapshot.\+upload\+\_\+mongo (\begin{DoxyParamCaption}\item[{}]{event,  }\item[{}]{final\+\_\+path,  }\item[{}]{snapshot,  }\item[{}]{period }\end{DoxyParamCaption})}

\begin{DoxyVerb}Creates and updates snapshot to mongoDB.

Args:
    event (dict): contains the file and client info
    final_path (str): Path where original csv is saved in s3
    snapshot (dict): it contains all fields info
    period (str): month and year when sales were processed
Returns: Nothing
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00097}{97}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

Here is the caller graph for this function\+:
% FIG 5


\doxysubsection{Variable Documentation}
\Hypertarget{namespace_report_snapshot_a59583ca70cb2351f5ddbd468db13ee24}\label{namespace_report_snapshot_a59583ca70cb2351f5ddbd468db13ee24} 
\index{ReportSnapshot@{ReportSnapshot}!ACCESS\_ID@{ACCESS\_ID}}
\index{ACCESS\_ID@{ACCESS\_ID}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{ACCESS\_ID}{ACCESS\_ID}}
{\footnotesize\ttfamily Report\+Snapshot.\+ACCESS\+\_\+\+ID}



Access keys for AWS. 



Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00019}{19}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

\Hypertarget{namespace_report_snapshot_a4c418fb519cd241f4820beb3d4c1b3e3}\label{namespace_report_snapshot_a4c418fb519cd241f4820beb3d4c1b3e3} 
\index{ReportSnapshot@{ReportSnapshot}!ACCESS\_KEY@{ACCESS\_KEY}}
\index{ACCESS\_KEY@{ACCESS\_KEY}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{ACCESS\_KEY}{ACCESS\_KEY}}
{\footnotesize\ttfamily Report\+Snapshot.\+ACCESS\+\_\+\+KEY}



Access keys for AWS. 



Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00019}{19}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

\Hypertarget{namespace_report_snapshot_a3d2d63b5a76762a3a9d446f2020ebfe4}\label{namespace_report_snapshot_a3d2d63b5a76762a3a9d446f2020ebfe4} 
\index{ReportSnapshot@{ReportSnapshot}!f\_path@{f\_path}}
\index{f\_path@{f\_path}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{f\_path}{f\_path}}
{\footnotesize\ttfamily Report\+Snapshot.\+f\+\_\+path = \+\_\+\+\_\+file\+\_\+\+\_\+}



Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00011}{11}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

\Hypertarget{namespace_report_snapshot_a9708b903819d920a4553e277f2f2290b}\label{namespace_report_snapshot_a9708b903819d920a4553e277f2f2290b} 
\index{ReportSnapshot@{ReportSnapshot}!final\_df@{final\_df}}
\index{final\_df@{final\_df}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{final\_df}{final\_df}}
{\footnotesize\ttfamily Report\+Snapshot.\+final\+\_\+df = Data\+Frame()}



Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00026}{26}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

\Hypertarget{namespace_report_snapshot_a493ebf6121b88a8b629ddb60e498f503}\label{namespace_report_snapshot_a493ebf6121b88a8b629ddb60e498f503} 
\index{ReportSnapshot@{ReportSnapshot}!index@{index}}
\index{index@{index}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{index}{index}}
{\footnotesize\ttfamily Report\+Snapshot.\+index = f\+\_\+path.\+find("{}report\+\_\+generation/"{})}



Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00012}{12}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

\Hypertarget{namespace_report_snapshot_a656392c6261d12e0cdfeb2dac6d382e0}\label{namespace_report_snapshot_a656392c6261d12e0cdfeb2dac6d382e0} 
\index{ReportSnapshot@{ReportSnapshot}!mongo\_conn@{mongo\_conn}}
\index{mongo\_conn@{mongo\_conn}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{mongo\_conn}{mongo\_conn}}
{\footnotesize\ttfamily Report\+Snapshot.\+mongo\+\_\+conn = mongo\+\_\+connection()}



Class to connect to mongodb. 



Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00022}{22}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

\Hypertarget{namespace_report_snapshot_a24e32d77f91c807604150367b99c10a7}\label{namespace_report_snapshot_a24e32d77f91c807604150367b99c10a7} 
\index{ReportSnapshot@{ReportSnapshot}!session@{session}}
\index{session@{session}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{session}{session}}
{\footnotesize\ttfamily Report\+Snapshot.\+session = boto3.\+Session(aws\+\_\+access\+\_\+key\+\_\+id=\mbox{\hyperlink{namespace_report_snapshot_a59583ca70cb2351f5ddbd468db13ee24}{ACCESS\+\_\+\+ID}}, aws\+\_\+secret\+\_\+access\+\_\+key= \mbox{\hyperlink{namespace_report_snapshot_a4c418fb519cd241f4820beb3d4c1b3e3}{ACCESS\+\_\+\+KEY}})}



Connection for AWS using boto3. 



Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00031}{31}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

\Hypertarget{namespace_report_snapshot_a934e21a368825fb600d7d4ffe7631953}\label{namespace_report_snapshot_a934e21a368825fb600d7d4ffe7631953} 
\index{ReportSnapshot@{ReportSnapshot}!snap\_collection@{snap\_collection}}
\index{snap\_collection@{snap\_collection}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{snap\_collection}{snap\_collection}}
{\footnotesize\ttfamily Report\+Snapshot.\+snap\+\_\+collection = mongo\+\_\+conn.\+mongo\+\_\+conn\+\_\+snapshots()}



Mongo collection to create/update snapshots. 



Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00024}{24}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

\Hypertarget{namespace_report_snapshot_a5076344f8f3c921e9d877dad90a54a84}\label{namespace_report_snapshot_a5076344f8f3c921e9d877dad90a54a84} 
\index{ReportSnapshot@{ReportSnapshot}!total\_local@{total\_local}}
\index{total\_local@{total\_local}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{total\_local}{total\_local}}
{\footnotesize\ttfamily int Report\+Snapshot.\+total\+\_\+local = 0}



Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00028}{28}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

\Hypertarget{namespace_report_snapshot_a60747d9e82279ba6a019e6e737f66ca0}\label{namespace_report_snapshot_a60747d9e82279ba6a019e6e737f66ca0} 
\index{ReportSnapshot@{ReportSnapshot}!total\_rows@{total\_rows}}
\index{total\_rows@{total\_rows}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{total\_rows}{total\_rows}}
{\footnotesize\ttfamily int Report\+Snapshot.\+total\+\_\+rows = 0}



Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00027}{27}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

\Hypertarget{namespace_report_snapshot_ad1d92ff734086f7f9a1d42f5ae674f59}\label{namespace_report_snapshot_ad1d92ff734086f7f9a1d42f5ae674f59} 
\index{ReportSnapshot@{ReportSnapshot}!update\_at@{update\_at}}
\index{update\_at@{update\_at}!ReportSnapshot@{ReportSnapshot}}
\doxysubsubsection{\texorpdfstring{update\_at}{update\_at}}
{\footnotesize\ttfamily Report\+Snapshot.\+update\+\_\+at = dt.\+now().replace(hour=0, minute=0, second=0, microsecond=0)}



It\textquotesingle{}s used to know when snapshot was created/updated. 



Definition at line \mbox{\hyperlink{_report_snapshot_8py_source_l00033}{33}} of file \mbox{\hyperlink{_report_snapshot_8py_source}{Report\+Snapshot.\+py}}.

