\doxysection{Download\+Files.\+py}
\hypertarget{_download_files_8py_source}{}\label{_download_files_8py_source}\index{/Users/michellmonroy/Documents/dev-\/glider/glider/src/upload\_module/gdrive/DownloadFiles.py@{/Users/michellmonroy/Documents/dev-\/glider/glider/src/upload\_module/gdrive/DownloadFiles.py}}
\mbox{\hyperlink{_download_files_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00001}\mbox{\hyperlink{namespace_download_files}{00001}}\ \textcolor{keyword}{from}\ \_\_future\_\_\ \textcolor{keyword}{import}\ print\_function}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00003}00003\ \textcolor{keyword}{import}\ io}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00004}00004\ \textcolor{keyword}{import}\ os}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00005}00005\ \textcolor{keyword}{import}\ google.auth}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00006}00006\ \textcolor{keyword}{from}\ google.oauth2.credentials\ \textcolor{keyword}{import}\ Credentials}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00007}00007\ \textcolor{keyword}{from}\ googleapiclient.discovery\ \textcolor{keyword}{import}\ build}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00008}00008\ \textcolor{keyword}{from}\ googleapiclient.errors\ \textcolor{keyword}{import}\ HttpError}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00009}00009\ \textcolor{keyword}{from}\ googleapiclient.http\ \textcolor{keyword}{import}\ MediaIoBaseDownload}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00010}00010\ \textcolor{keyword}{from}\ urllib.request\ \textcolor{keyword}{import}\ urlretrieve}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00012}00012\ }
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00013}\mbox{\hyperlink{namespace_download_files_aec0e8b32c29176d76bcf1bb7ab911b17}{00013}}\ \textcolor{keyword}{def\ }download\_file\_or\_folder(file\_id,\ path):}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00014}00014\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00015}00015\ \textcolor{stringliteral}{\ \ \ \ Downloads\ a\ file\ or\ a\ folder\ from\ Google\ Drive}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00016}00016\ \textcolor{stringliteral}{\ \ \ \ Args:}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00017}00017\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ file\_id\ (str):\ ID\ of\ the\ folder/file\ to\ download}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00018}00018\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ path\ (str):\ Local\ path\ where\ file(s)\ will\ be\ downloaded}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00019}00019\ \textcolor{stringliteral}{\ \ \ \ Returns\ :\ Nothing}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00020}00020\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00021}00021\ \ \ \ \ \textcolor{comment}{\#\ creds,\ project\_id\ =\ google.auth.default()}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00022}00022\ \ \ \ \ \textcolor{comment}{\#\ dir\_path\ =\ os.path.dirname("{}glider/"{})}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00023}00023\ \ \ \ \ \textcolor{comment}{\#\ base\_path\ =\ os.path.basename(os.getcwd())}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00024}00024\ \ \ \ \ \textcolor{comment}{\#\ full\_path\ =\ dir\_path+"{}/"{}+base\_path}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00025}00025\ \ \ \ \ full\_path\ =\ \_\_file\_\_}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00026}00026\ \ \ \ \ rel\_path\ =\ full\_path.split(\textcolor{stringliteral}{"{}/"{}})[:-\/1]}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00027}00027\ \ \ \ \ rel\_path\ =\ \textcolor{stringliteral}{"{}/"{}}.join(rel\_path)}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00028}00028\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00029}00029\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ create\ drive\ api\ client}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00030}00030\ \ \ \ \ \ \ \ \ SCOPES\ =\ [\textcolor{stringliteral}{"{}https://www.googleapis.com/auth/drive"{}},\ \textcolor{stringliteral}{"{}https://www.googleapis.com/auth/drive.file"{}},\ \textcolor{stringliteral}{"{}https://www.googleapis.com/auth/drive.readonly"{}},\ }
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00031}00031\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}https://www.googleapis.com/auth/drive.metadata.readonly"{}},\ \textcolor{stringliteral}{"{}https://www.googleapis.com/auth/drive.appdata"{}},\ \textcolor{stringliteral}{"{}https://www.googleapis.com/auth/drive.metadata"{}},\ }
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00032}00032\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}https://www.googleapis.com/auth/drive.photos.readonly"{}}]}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00033}00033\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ SCOPES\ =\ ['https://www.googleapis.com/auth/spreadsheets',\ "{}https://www.googleapis.com/auth/drive.file"{},\ "{}https://www.googleapis.com/auth/drive"{}]}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00034}00034\ \ \ \ \ \ \ \ \ creds\ =\ Credentials.from\_authorized\_user\_file(rel\_path+\textcolor{stringliteral}{"{}/token.json"{}},\ SCOPES)}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00035}00035\ \ \ \ \ \ \ \ \ service\ =\ build(\textcolor{stringliteral}{"{}drive"{}},\ \textcolor{stringliteral}{"{}v3"{}},\ credentials=creds)}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00036}00036\ }
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00037}00037\ \ \ \ \ \ \ \ \ file\ =\ service.files().get(fileId=file\_id,\ fields=\textcolor{stringliteral}{"{}name,\ mimeType"{}}).execute()}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00038}00038\ \ \ \ \ \ \ \ \ file\_name\ =\ file[\textcolor{stringliteral}{"{}name"{}}]}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00039}00039\ \ \ \ \ \ \ \ \ mime\_type\ =\ file[\textcolor{stringliteral}{"{}mimeType"{}}]}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00040}00040\ \ \ \ \ \ \ \ \ new\_path\ =\ os.path.join(path,\ file\_name)}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00041}00041\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ mime\_type\ ==\ \textcolor{stringliteral}{"{}application/vnd.google-\/apps.folder"{}}:}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00042}00042\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ If\ it's\ a\ folder,\ create\ a\ corresponding\ local\ directory\ and\ download\ its\ contents}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00043}00043\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ os.path.exists(new\_path):}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00044}00044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ os.makedirs(new\_path)}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00045}00045\ \ \ \ \ \ \ \ \ \ \ \ \ results\ =\ service.files().list(q=\textcolor{stringliteral}{"{}'\{\}'\ in\ parents"{}}.format(file\_id),\ fields=\textcolor{stringliteral}{"{}nextPageToken,\ files(id,\ name)"{}}).execute()}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00046}00046\ \ \ \ \ \ \ \ \ \ \ \ \ items\ =\ results.get(\textcolor{stringliteral}{"{}files"{}},\ [])}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00047}00047\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ item\ \textcolor{keywordflow}{in}\ items:}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00048}00048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ download\_file\_or\_folder(item[\textcolor{stringliteral}{'id'}],\ new\_path)}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00049}00049\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00050}00050\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ If\ it's\ a\ file,\ download\ it\ to\ the\ local\ directory}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00051}00051\ \ \ \ \ \ \ \ \ \ \ \ \ request\ =\ service.files().get\_media(fileId=file\_id)}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ fh\ =\ io.BytesIO()}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \ \ \ downloader\ =\ MediaIoBaseDownload(fh,\ request)}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00054}00054\ \ \ \ \ \ \ \ \ \ \ \ \ done\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ done\ \textcolor{keywordflow}{is}\ \textcolor{keyword}{False}:}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00056}00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ status,\ done\ =\ downloader.next\_chunk()}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00057}00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(\textcolor{stringliteral}{"{}Download\ \%d\%\%."{}}\ \%\ int(status.progress()\ *\ 100))}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00058}00058\ \ \ \ \ \ \ \ \ \ \ \ \ fh.seek(0)}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00060}00060\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ open(new\_path,\ \textcolor{stringliteral}{"{}wb"{}})\ \textcolor{keyword}{as}\ f:}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00061}00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.write(fh.read())}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00062}00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f.close()}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00063}00063\ }
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00064}00064\ \ \ \ \ \textcolor{keywordflow}{except}\ HttpError\ \textcolor{keyword}{as}\ error:}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00065}00065\ \ \ \ \ \ \ \ \ print(\textcolor{stringliteral}{"{}An\ error\ occurred:\ \{\}"{}}.format(error))}
\DoxyCodeLine{\Hypertarget{_download_files_8py_source_l00066}00066\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ Exception(\textcolor{stringliteral}{"{}Some\ files\ can\ not\ be\ downloaded"{}})}

\end{DoxyCode}
