\doxysection{importer.\+Create\+Snapshots Namespace Reference}
\hypertarget{namespaceimporter_1_1_create_snapshots}{}\label{namespaceimporter_1_1_create_snapshots}\index{importer.CreateSnapshots@{importer.CreateSnapshots}}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespaceimporter_1_1_create_snapshots_a7914ca118e4fd4de28fcde5343b3a575}{get\+\_\+data}} (file, bucket\+\_\+out, path\+\_\+out)
\item 
\mbox{\hyperlink{namespaceimporter_1_1_create_snapshots_a56f0db3e03f459fc489bfc65e34fae47}{group\+\_\+by\+\_\+field}} (data, fields, snapshot)
\item 
\mbox{\hyperlink{namespaceimporter_1_1_create_snapshots_a708f3c910c8c8ce8d7656985fd96b8c6}{build\+\_\+snapshot}} (df, field, snapshot)
\item 
\mbox{\hyperlink{namespaceimporter_1_1_create_snapshots_a071e9ae52b38709ce3c8bd02a9bd9c29}{upload\+\_\+mongo}} (results, file\+\_\+db\+\_\+id, update, length)
\item 
\mbox{\hyperlink{namespaceimporter_1_1_create_snapshots_aee5fb2ba3058cce272feb71ff79ffe1a}{results\+\_\+grouped}} (event, context)
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespaceimporter_1_1_create_snapshots_a5ecc0c11bb15661c60ec760f22e6854d}{mongo\+\_\+conn}} = \mbox{\hyperlink{classimporter_1_1_mongo_connection_1_1mongo__connection}{mongo\+\_\+connection}}()
\begin{DoxyCompactList}\small\item\em Class to connect to mongodb. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespaceimporter_1_1_create_snapshots_a00acb278f979b26d00e299a3cee07cad}{collection}} = mongo\+\_\+conn.\+mongo\+\_\+conn\+\_\+snapshots()
\begin{DoxyCompactList}\small\item\em Mongo collection to upload snapshots. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespaceimporter_1_1_create_snapshots_afe3f23932326ea8bdfe8c5e5f5f535a4}{ACCESS\+\_\+\+ID}}
\begin{DoxyCompactList}\small\item\em Access keys for AWS. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespaceimporter_1_1_create_snapshots_a9a513882f61bb91ce61944ccbf878c81}{ACCESS\+\_\+\+KEY}}
\begin{DoxyCompactList}\small\item\em Access keys for AWS. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespaceimporter_1_1_create_snapshots_ae5850639a2be42e542f26e5ca43165a0}{s3\+\_\+session}} = boto3.\+Session(aws\+\_\+access\+\_\+key\+\_\+id=\mbox{\hyperlink{namespaceimporter_1_1_create_snapshots_afe3f23932326ea8bdfe8c5e5f5f535a4}{ACCESS\+\_\+\+ID}}, aws\+\_\+secret\+\_\+access\+\_\+key=\mbox{\hyperlink{namespaceimporter_1_1_create_snapshots_a9a513882f61bb91ce61944ccbf878c81}{ACCESS\+\_\+\+KEY}})
\begin{DoxyCompactList}\small\item\em Connection for AWS using boto3. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\Hypertarget{namespaceimporter_1_1_create_snapshots_a708f3c910c8c8ce8d7656985fd96b8c6}\label{namespaceimporter_1_1_create_snapshots_a708f3c910c8c8ce8d7656985fd96b8c6} 
\index{importer.CreateSnapshots@{importer.CreateSnapshots}!build\_snapshot@{build\_snapshot}}
\index{build\_snapshot@{build\_snapshot}!importer.CreateSnapshots@{importer.CreateSnapshots}}
\doxysubsubsection{\texorpdfstring{build\_snapshot()}{build\_snapshot()}}
{\footnotesize\ttfamily importer.\+Create\+Snapshots.\+build\+\_\+snapshot (\begin{DoxyParamCaption}\item[{}]{df,  }\item[{}]{field,  }\item[{}]{snapshot }\end{DoxyParamCaption})}

\begin{DoxyVerb}Checks the field and fill the snapshot field using grouped data.

Args:
    data (pandas dataframe): current parquet file loaded as dataframe
    field (str): current file used as filter
    snapshot (dict): it will contain all fields info
Returns: snapshot (dict)
\end{DoxyVerb}
 \Hypertarget{namespaceimporter_1_1_create_snapshots_a7914ca118e4fd4de28fcde5343b3a575}\label{namespaceimporter_1_1_create_snapshots_a7914ca118e4fd4de28fcde5343b3a575} 
\index{importer.CreateSnapshots@{importer.CreateSnapshots}!get\_data@{get\_data}}
\index{get\_data@{get\_data}!importer.CreateSnapshots@{importer.CreateSnapshots}}
\doxysubsubsection{\texorpdfstring{get\_data()}{get\_data()}}
{\footnotesize\ttfamily importer.\+Create\+Snapshots.\+get\+\_\+data (\begin{DoxyParamCaption}\item[{}]{file,  }\item[{}]{bucket\+\_\+out,  }\item[{}]{path\+\_\+out }\end{DoxyParamCaption})}

\begin{DoxyVerb}Receives a S3 path and loads the data using awswrangler 

Args:
    file (str): current filename
    bucket_out (str): bucket where parquet file is storage
    path_out (str): s3 path where parquet file is storage
Returns: df (pandas dataframe)
\end{DoxyVerb}
 \Hypertarget{namespaceimporter_1_1_create_snapshots_a56f0db3e03f459fc489bfc65e34fae47}\label{namespaceimporter_1_1_create_snapshots_a56f0db3e03f459fc489bfc65e34fae47} 
\index{importer.CreateSnapshots@{importer.CreateSnapshots}!group\_by\_field@{group\_by\_field}}
\index{group\_by\_field@{group\_by\_field}!importer.CreateSnapshots@{importer.CreateSnapshots}}
\doxysubsubsection{\texorpdfstring{group\_by\_field()}{group\_by\_field()}}
{\footnotesize\ttfamily importer.\+Create\+Snapshots.\+group\+\_\+by\+\_\+field (\begin{DoxyParamCaption}\item[{}]{data,  }\item[{}]{fields,  }\item[{}]{snapshot }\end{DoxyParamCaption})}

\begin{DoxyVerb}Group by service_id, territory_code, artists and tracks

Args:
    data (pandas dataframe): current parquet file loaded as dataframe
    fields (list): list of fields that are considered to snapshot
    snapshot (dict): it will contain all fields info
Returns: snap (dict)
\end{DoxyVerb}
 \Hypertarget{namespaceimporter_1_1_create_snapshots_aee5fb2ba3058cce272feb71ff79ffe1a}\label{namespaceimporter_1_1_create_snapshots_aee5fb2ba3058cce272feb71ff79ffe1a} 
\index{importer.CreateSnapshots@{importer.CreateSnapshots}!results\_grouped@{results\_grouped}}
\index{results\_grouped@{results\_grouped}!importer.CreateSnapshots@{importer.CreateSnapshots}}
\doxysubsubsection{\texorpdfstring{results\_grouped()}{results\_grouped()}}
{\footnotesize\ttfamily importer.\+Create\+Snapshots.\+results\+\_\+grouped (\begin{DoxyParamCaption}\item[{}]{event,  }\item[{}]{context }\end{DoxyParamCaption})}

\begin{DoxyVerb}Executes full procedure

Args:
    event (dict): is a ictionary with all client and sales information
    context (none): it's required just for lambda execution
Returns: (dict)
\end{DoxyVerb}
 \Hypertarget{namespaceimporter_1_1_create_snapshots_a071e9ae52b38709ce3c8bd02a9bd9c29}\label{namespaceimporter_1_1_create_snapshots_a071e9ae52b38709ce3c8bd02a9bd9c29} 
\index{importer.CreateSnapshots@{importer.CreateSnapshots}!upload\_mongo@{upload\_mongo}}
\index{upload\_mongo@{upload\_mongo}!importer.CreateSnapshots@{importer.CreateSnapshots}}
\doxysubsubsection{\texorpdfstring{upload\_mongo()}{upload\_mongo()}}
{\footnotesize\ttfamily importer.\+Create\+Snapshots.\+upload\+\_\+mongo (\begin{DoxyParamCaption}\item[{}]{results,  }\item[{}]{file\+\_\+db\+\_\+id,  }\item[{}]{update,  }\item[{}]{length }\end{DoxyParamCaption})}

\begin{DoxyVerb}Update fields using snapshot variable.

Args:
    results (dict): current parquet file loaded as dataframe
    file_db_id (str): list of fields that are considered to snapshot
    update (datetime stamp): the current datetime where snapshot is updated
    length (int): total rows
Returns: None
\end{DoxyVerb}
 

\doxysubsection{Variable Documentation}
\Hypertarget{namespaceimporter_1_1_create_snapshots_afe3f23932326ea8bdfe8c5e5f5f535a4}\label{namespaceimporter_1_1_create_snapshots_afe3f23932326ea8bdfe8c5e5f5f535a4} 
\index{importer.CreateSnapshots@{importer.CreateSnapshots}!ACCESS\_ID@{ACCESS\_ID}}
\index{ACCESS\_ID@{ACCESS\_ID}!importer.CreateSnapshots@{importer.CreateSnapshots}}
\doxysubsubsection{\texorpdfstring{ACCESS\_ID}{ACCESS\_ID}}
{\footnotesize\ttfamily importer.\+Create\+Snapshots.\+ACCESS\+\_\+\+ID}



Access keys for AWS. 

\Hypertarget{namespaceimporter_1_1_create_snapshots_a9a513882f61bb91ce61944ccbf878c81}\label{namespaceimporter_1_1_create_snapshots_a9a513882f61bb91ce61944ccbf878c81} 
\index{importer.CreateSnapshots@{importer.CreateSnapshots}!ACCESS\_KEY@{ACCESS\_KEY}}
\index{ACCESS\_KEY@{ACCESS\_KEY}!importer.CreateSnapshots@{importer.CreateSnapshots}}
\doxysubsubsection{\texorpdfstring{ACCESS\_KEY}{ACCESS\_KEY}}
{\footnotesize\ttfamily importer.\+Create\+Snapshots.\+ACCESS\+\_\+\+KEY}



Access keys for AWS. 

\Hypertarget{namespaceimporter_1_1_create_snapshots_a00acb278f979b26d00e299a3cee07cad}\label{namespaceimporter_1_1_create_snapshots_a00acb278f979b26d00e299a3cee07cad} 
\index{importer.CreateSnapshots@{importer.CreateSnapshots}!collection@{collection}}
\index{collection@{collection}!importer.CreateSnapshots@{importer.CreateSnapshots}}
\doxysubsubsection{\texorpdfstring{collection}{collection}}
{\footnotesize\ttfamily importer.\+Create\+Snapshots.\+collection = mongo\+\_\+conn.\+mongo\+\_\+conn\+\_\+snapshots()}



Mongo collection to upload snapshots. 

\Hypertarget{namespaceimporter_1_1_create_snapshots_a5ecc0c11bb15661c60ec760f22e6854d}\label{namespaceimporter_1_1_create_snapshots_a5ecc0c11bb15661c60ec760f22e6854d} 
\index{importer.CreateSnapshots@{importer.CreateSnapshots}!mongo\_conn@{mongo\_conn}}
\index{mongo\_conn@{mongo\_conn}!importer.CreateSnapshots@{importer.CreateSnapshots}}
\doxysubsubsection{\texorpdfstring{mongo\_conn}{mongo\_conn}}
{\footnotesize\ttfamily importer.\+Create\+Snapshots.\+mongo\+\_\+conn = \mbox{\hyperlink{classimporter_1_1_mongo_connection_1_1mongo__connection}{mongo\+\_\+connection}}()}



Class to connect to mongodb. 

\Hypertarget{namespaceimporter_1_1_create_snapshots_ae5850639a2be42e542f26e5ca43165a0}\label{namespaceimporter_1_1_create_snapshots_ae5850639a2be42e542f26e5ca43165a0} 
\index{importer.CreateSnapshots@{importer.CreateSnapshots}!s3\_session@{s3\_session}}
\index{s3\_session@{s3\_session}!importer.CreateSnapshots@{importer.CreateSnapshots}}
\doxysubsubsection{\texorpdfstring{s3\_session}{s3\_session}}
{\footnotesize\ttfamily importer.\+Create\+Snapshots.\+s3\+\_\+session = boto3.\+Session(aws\+\_\+access\+\_\+key\+\_\+id=\mbox{\hyperlink{namespaceimporter_1_1_create_snapshots_afe3f23932326ea8bdfe8c5e5f5f535a4}{ACCESS\+\_\+\+ID}}, aws\+\_\+secret\+\_\+access\+\_\+key=\mbox{\hyperlink{namespaceimporter_1_1_create_snapshots_a9a513882f61bb91ce61944ccbf878c81}{ACCESS\+\_\+\+KEY}})}



Connection for AWS using boto3. 

