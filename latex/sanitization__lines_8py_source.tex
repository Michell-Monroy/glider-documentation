\doxysection{sanitization\+\_\+lines.\+py}
\hypertarget{sanitization__lines_8py_source}{}\label{sanitization__lines_8py_source}\index{/Users/michellmonroy/Documents/dev-\/glider/glider/src/catalog/MongoDB/sanitization\_lines.py@{/Users/michellmonroy/Documents/dev-\/glider/glider/src/catalog/MongoDB/sanitization\_lines.py}}
\mbox{\hyperlink{sanitization__lines_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00001}\mbox{\hyperlink{namespacesanitization__lines}{00001}}\ \textcolor{keyword}{from}\ bson.objectid\ \textcolor{keyword}{import}\ ObjectId}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00002}00002\ \textcolor{keyword}{import}\ os}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00003}00003\ \textcolor{keyword}{import}\ sys}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00004}00004\ \textcolor{keyword}{import}\ traceback}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00005}00005\ \textcolor{keyword}{import}\ ssl}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00006}00006\ \textcolor{keyword}{import}\ datetime}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00007}00007\ \textcolor{keyword}{from}\ optparse\ \textcolor{keyword}{import}\ OptionParser}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00008}00008\ \textcolor{keyword}{from}\ pymongo\ \textcolor{keyword}{import}\ MongoClient}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00009}00009\ \textcolor{keyword}{from}\ dotenv\ \textcolor{keyword}{import}\ load\_dotenv}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00010}00010\ }
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00011}00011\ load\_dotenv()}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00012}00012\ }
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00013}\mbox{\hyperlink{namespacesanitization__lines_a82e5379b1b69c7583c931e90db833eb0}{00013}}\ uri\ =\ os.environ.get(\textcolor{stringliteral}{"{}MONGO\_GLIDER"{}})}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00014}\mbox{\hyperlink{namespacesanitization__lines_a45d15dccf798ab6a7829b747c56f13d6}{00014}}\ db\_name\ =\ os.environ.get(\textcolor{stringliteral}{"{}DB"{}})}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00015}\mbox{\hyperlink{namespacesanitization__lines_ae42fa97725e3a7ce88b142574b5aca16}{00015}}\ collection\_name\ =\ os.environ.get(\textcolor{stringliteral}{"{}COLLECTION"{}})}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00016}00016\ \textcolor{comment}{\#\ catalog\_name\ =\ "{}audiosalad\_gyro"{}}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00018}\mbox{\hyperlink{namespacesanitization__lines_adea86de830e5b3bd41e5d5a9250e3a8b}{00018}}\ client\ =\ MongoClient(uri,ssl\_cert\_reqs=ssl.CERT\_NONE,\ connect=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00019}\mbox{\hyperlink{namespacesanitization__lines_a412f4dfd80b489202b0aaa2c87d91d48}{00019}}\ db\ =\ client[db\_name]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00020}\mbox{\hyperlink{namespacesanitization__lines_af4a8274c7a03b9ef909bc5a035745f47}{00020}}\ sales\_collection\ =\ db[collection\_name]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00021}00021\ }
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00022}\mbox{\hyperlink{namespacesanitization__lines_a1bbf420ab87bea3b32ea2efbc4b918b4}{00022}}\ request\_upc\ =\ []}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00023}00023\ \textcolor{comment}{\#\ upc\_del\ =\ []}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00024}00024\ \textcolor{keyword}{global}\ date,\ catalog\_collection}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00025}\mbox{\hyperlink{namespacesanitization__lines_a5c624405dc5cd2ff6f3fc158894623a8}{00025}}\ c=0}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00027}00027\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00028}\mbox{\hyperlink{namespacesanitization__lines_a392574c6e0a2fca1586c47af3b7b0971}{00028}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacesanitization__lines_a392574c6e0a2fca1586c47af3b7b0971}{add\_parser\_options}}():}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00029}00029\ \ \ \ \ parser\ =\ OptionParser()}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00030}00030\ \ \ \ \ parser.add\_option(\textcolor{stringliteral}{"{}-\/s"{}},\ \textcolor{stringliteral}{"{}-\/-\/start"{}},\ type=\textcolor{stringliteral}{"{}int"{}},\ dest=\textcolor{stringliteral}{"{}start"{}},\ help=\textcolor{stringliteral}{"{}Index\ to\ initialize\ Pymongo\ cursor"{}})}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00031}00031\ \ \ \ \ parser.add\_option(\textcolor{stringliteral}{"{}-\/e"{}},\ \textcolor{stringliteral}{"{}-\/-\/end"{}},\ type=\textcolor{stringliteral}{"{}int"{}},\ dest=\textcolor{stringliteral}{"{}end"{}},\ help=\textcolor{stringliteral}{"{}Index\ to\ finalize\ Pymongo\ cursor"{}})}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00032}00032\ \ \ \ \ parser.add\_option(\textcolor{stringliteral}{"{}-\/n"{}},\ \textcolor{stringliteral}{"{}-\/-\/split"{}},\ type=\textcolor{stringliteral}{"{}int"{}},\ dest=\textcolor{stringliteral}{"{}split"{}},\ help=\textcolor{stringliteral}{"{}Numbert\ of\ parts\ to\ split\ the\ procedure"{}})}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00033}00033\ \ \ \ \ parser.add\_option(\textcolor{stringliteral}{"{}-\/c"{}},\ \textcolor{stringliteral}{"{}-\/-\/catalog"{}},\ type=\textcolor{stringliteral}{"{}str"{}},\ dest=\textcolor{stringliteral}{"{}catalog\_name"{}},\ help=\textcolor{stringliteral}{"{}Catalog\ Mongo\ Collection\ (audiosalad\ or\ audiosalad\_gyro)"{}})}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00034}00034\ \ \ \ \ parser.add\_option(\textcolor{stringliteral}{"{}-\/d"{}},\ \textcolor{stringliteral}{"{}-\/-\/date"{}},\ type=\textcolor{stringliteral}{"{}str"{}},\ dest=\textcolor{stringliteral}{"{}date"{}},\ help=\textcolor{stringliteral}{"{}Sales\ Accounting\ Period\ in\ yyyy-\/mm-\/dd\ format"{}})}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00035}00035\ \ \ \ \ (options,\ args)\ =\ parser.parse\_args()}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00036}00036\ \ \ \ \ \textcolor{keywordflow}{return}\ options}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00038}\mbox{\hyperlink{namespacesanitization__lines_a93ca6ee4e0dcb936979c54186b9f2f7c}{00038}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacesanitization__lines_a93ca6ee4e0dcb936979c54186b9f2f7c}{search}}(sales,\ releases\_list):}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00039}00039\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00040}00040\ \textcolor{stringliteral}{\ \ \ \ args:}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00041}00041\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ -\/\ sales\ (pymongo\ cursor\ item):\ line\ to\ update\ information}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00042}00042\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ -\/\ releases\_list\ (cursor/list):\ Catalog\ list\ with\ release\ information}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00043}00043\ \textcolor{stringliteral}{\ \ \ \ returns:}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00044}00044\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ -\/\ Nothing}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00045}00045\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00046}00046\ \ \ \ \ \textcolor{keywordflow}{if}\ sales[\textcolor{stringliteral}{"{}release\_id"{}}]\ ==\ \textcolor{stringliteral}{"{}"{}}\ \textcolor{keywordflow}{or}\ str(sales[\textcolor{stringliteral}{"{}release\_id"{}}])\ ==\ \textcolor{stringliteral}{"{}nan"{}}:}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00047}00047\ \ \ \ \ \ \ \ \ upc\_search\ =\ catalog\_collection.find\_one(\{\textcolor{stringliteral}{"{}tracks.isrc"{}}:sales[\textcolor{stringliteral}{"{}isrc\_id"{}}]\},\{\textcolor{stringliteral}{"{}\_id"{}}:0,\ \textcolor{stringliteral}{"{}upc"{}}:1,\textcolor{stringliteral}{"{}title"{}}:1,\textcolor{stringliteral}{"{}label"{}}:1,\textcolor{stringliteral}{"{}artist"{}}:1,\textcolor{stringliteral}{"{}tracks.isrc"{}}:1,\ \textcolor{stringliteral}{"{}tracks.title"{}}:1,\ \textcolor{stringliteral}{"{}tracks.artist"{}}:1\})}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00048}00048\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ upc\_search:}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00049}00049\ \ \ \ \ \ \ \ \ \ \ \ \ isrc\_search\ =\ [element\ \textcolor{keywordflow}{for}\ element\ \textcolor{keywordflow}{in}\ upc\_search[\textcolor{stringliteral}{"{}tracks"{}}]\ \textcolor{keywordflow}{if}\ element[\textcolor{stringliteral}{"{}isrc"{}}]\ ==\ sales[\textcolor{stringliteral}{"{}isrc\_id"{}}]]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00050}00050\ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}release\_id"{}}]\ =\ upc\_search[\textcolor{stringliteral}{"{}upc"{}}]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00051}00051\ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}release\_title"{}}]\ =\ upc\_search[\textcolor{stringliteral}{"{}title"{}}]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}label\_id"{}}]\ =\ upc\_search[\textcolor{stringliteral}{"{}label"{}}]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}track\_title"{}}]\ =\ isrc\_search[0][\textcolor{stringliteral}{"{}title"{}}]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00054}00054\ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}artists"{}}]\ =\ isrc\_search[0][\textcolor{stringliteral}{"{}artist"{}}]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}accounting\_date"{}}]\ =\ date}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00056}00056\ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}clean"{}}]\ =\ 1}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00057}00057\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00058}00058\ \ \ \ \ \ \ \ \ upc\_search\ =\ [element\ \textcolor{keywordflow}{for}\ element\ \textcolor{keywordflow}{in}\ releases\_list\ \textcolor{keywordflow}{if}\ element[\textcolor{stringliteral}{'upc'}]\ ==\ sales[\textcolor{stringliteral}{"{}release\_id"{}}]]\textcolor{comment}{\#\ and\ element["{}tracks"{}]\ ==\ track\_sales]}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00059}00059\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(upc\_search)\ >\ 0:}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00060}00060\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(sales[\textcolor{stringliteral}{"{}isrc\_id"{}}])\ >=\ 11:}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00061}00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ isrc\_search\ =\ [element\ \textcolor{keywordflow}{for}\ element\ \textcolor{keywordflow}{in}\ upc\_search[0][\textcolor{stringliteral}{"{}tracks"{}}]\ \textcolor{keywordflow}{if}\ element[\textcolor{stringliteral}{"{}isrc"{}}]\ ==\ sales[\textcolor{stringliteral}{"{}isrc\_id"{}}]]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00062}00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}release\_title"{}}]\ =\ upc\_search[0][\textcolor{stringliteral}{"{}title"{}}]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00063}00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}label\_id"{}}]\ =\ upc\_search[0][\textcolor{stringliteral}{"{}label"{}}]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00064}00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}track\_title"{}}]\ =\ isrc\_search[0][\textcolor{stringliteral}{"{}title"{}}]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00065}00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}artists"{}}]\ =\ isrc\_search[0][\textcolor{stringliteral}{"{}artist"{}}]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00066}00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}accounting\_date"{}}]\ =\ date}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00067}00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}clean"{}}]\ =\ 1}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00068}00068\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ elif\ str(sales["{}isrc\_id"{}])\ ==\ "{}nan"{}\ or\ sales["{}isrc\_id"{}]\ ==\ "{}"{}\ or\ sales["{}isrc\_id"{}]\ ==\ "{}"{}:}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00069}00069\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}release\_title"{}}]\ =\ upc\_search[0][\textcolor{stringliteral}{"{}title"{}}]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}label\_id"{}}]\ =\ upc\_search[0][\textcolor{stringliteral}{"{}label"{}}]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00072}00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}artists"{}}]\ =\ upc\_search[0][\textcolor{stringliteral}{"{}artist"{}}]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}accounting\_date"{}}]\ =\ date}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00074}00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sales[\textcolor{stringliteral}{"{}clean"{}}]\ =\ 1}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00075}00075\ }
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00076}\mbox{\hyperlink{namespacesanitization__lines_a4b6f9f468cce528eeec0095650038408}{00076}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacesanitization__lines_a4b6f9f468cce528eeec0095650038408}{update\_releases}}(delete\_id,\ new\_rels):}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00077}00077\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00078}00078\ \textcolor{stringliteral}{\ \ \ \ args:}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00079}00079\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ -\/\ delete\_id\ (list):\ Mongo\ id\ to\ delete}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00080}00080\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ -\/\ new\_rels\ (list):\ Releases\ updated\ list}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00081}00081\ \textcolor{stringliteral}{\ \ \ \ returns:}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00082}00082\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ -\/\ Nothing}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00083}00083\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00084}00084\ \ \ \ \ print(\textcolor{stringliteral}{"{}********DELETING\ OLD\ DATA\ SALES********"{}})}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00085}00085\ \ \ \ \ sales\_collection.delete\_many(\{\textcolor{stringliteral}{"{}\_id"{}}:\ \{\textcolor{stringliteral}{"{}\$in"{}}:delete\_id\}\})}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00086}00086\ \ \ \ \ print(\textcolor{stringliteral}{"{}********INSERTING\ NEW\ DATA\ SALES********"{}})}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00087}00087\ \ \ \ \ sales\_collection.insert\_many(new\_rels)}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00088}00088\ }
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00089}\mbox{\hyperlink{namespacesanitization__lines_a3e6b9b77da7884560aa7368a10b111a4}{00089}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacesanitization__lines_a3e6b9b77da7884560aa7368a10b111a4}{run\_sanitization}}(limit,\ releases):}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00090}00090\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00091}00091\ \textcolor{stringliteral}{\ \ \ \ args:}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00092}00092\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ -\/\ sales\ (pymongo\ cursor\ item):\ line\ to\ update\ information}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00093}00093\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ -\/\ releases\ (cursor/list):\ Catalog\ list\ with\ release\ information}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00094}00094\ \textcolor{stringliteral}{\ \ \ \ returns:}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00095}00095\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ -\/\ Nothing}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00096}00096\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00097}00097\ \ \ \ \ \textcolor{keyword}{global}\ c,\ request\_upc,\ upc\_del}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00098}00098\ \ \ \ \ sales\ =\ sales\_collection.find(\{\textcolor{stringliteral}{"{}\_id"{}}:\ \{\textcolor{stringliteral}{"{}\$in"{}}:limit\}\},no\_cursor\_timeout=\textcolor{keyword}{True},\ batch\_size=20)\ \textcolor{comment}{\#batch\_size=20\ to\ avoid\ cursor\ breaks\ down}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00099}00099\ \ \ \ \ \textcolor{keyword}{with}\ sales:}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00100}00100\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ sales:}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00101}00101\ \ \ \ \ \ \ \ \ \ \ \ \ print(c)}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00102}00102\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00103}00103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(i[\textcolor{stringliteral}{"{}release\_id"{}}],\ i[\textcolor{stringliteral}{"{}isrc\_id"{}}])}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00104}00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesanitization__lines_a93ca6ee4e0dcb936979c54186b9f2f7c}{search}}(i,\ releases)}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00105}00105\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00106}00106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ print(sys.exc\_info()[2])}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00107}00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ print(traceback.format\_exc())}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00108}00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00109}00109\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ upc\_del.append(i["{}\_id"{}])}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00110}00110\ \ \ \ \ \ \ \ \ \ \ \ \ request\_upc.append(i)}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00111}00111\ \ \ \ \ \ \ \ \ \ \ \ \ c+=1}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00112}00112\ \ \ \ \ sales.close()}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00113}00113\ }
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00114}\mbox{\hyperlink{namespacesanitization__lines_a413903bce008645932e25e478227d6ed}{00114}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacesanitization__lines_a413903bce008645932e25e478227d6ed}{split\_list}}(id\_list,parts):}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00115}00115\ \ \ \ \ \textcolor{keywordflow}{return}\ [id\_list[i::parts]\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range(parts)]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00116}00116\ }
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00117}\mbox{\hyperlink{namespacesanitization__lines_a0bca99ba0b24b4fefe2eb0426e90c77f}{00117}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacemain}{main}}(options):}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00118}00118\ \ \ \ \ catalog\_collection\ =\ db[options.catalog\_name]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00119}00119\ \ \ \ \ id\_list\ =\ list(sales\_collection.find(\{\textcolor{stringliteral}{"{}accounting\_date"{}}:\ date,\ \textcolor{stringliteral}{"{}clean"{}}:\{\textcolor{stringliteral}{"{}\$exists"{}}:\ \textcolor{keyword}{False}\}\},\{\textcolor{stringliteral}{"{}\_id"{}}:1\})[options.start:options.end])}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00120}00120\ \ \ \ \ id\_list\ =\ [i[\textcolor{stringliteral}{"{}\_id"{}}]\ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ id\_list]}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00121}00121\ \ \ \ \ \textcolor{comment}{\#\ sales\ =\ sales\_collection.find(\{"{}accounting\_date"{}:\ date,\ "{}clean"{}:\{"{}\$exists"{}:\ False\}\},no\_cursor\_timeout=True,\ batch\_size=20)\ \#batch\_size=20\ to\ avoid\ cursor\ breaks\ down}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00122}00122\ \ \ \ \ releases\ =\ list(catalog\_collection.find(\{\},\{\textcolor{stringliteral}{"{}\_id"{}}:0,\ \textcolor{stringliteral}{"{}upc"{}}:1,\textcolor{stringliteral}{"{}title"{}}:1,\textcolor{stringliteral}{"{}label"{}}:1,\textcolor{stringliteral}{"{}artist"{}}:1,\textcolor{stringliteral}{"{}tracks.isrc"{}}:1,\ \textcolor{stringliteral}{"{}tracks.title"{}}:1,\ \textcolor{stringliteral}{"{}tracks.artist"{}}:1\}))}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00123}00123\ \ \ \ \ id\_list\_split\ =\ \mbox{\hyperlink{namespacesanitization__lines_a413903bce008645932e25e478227d6ed}{split\_list}}(id\_list,\ options.split)}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00124}00124\ \ \ \ \ \textcolor{keywordflow}{for}\ sample\_id\ \textcolor{keywordflow}{in}\ id\_list\_split:}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00125}00125\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacesanitization__lines_a3e6b9b77da7884560aa7368a10b111a4}{run\_sanitization}}(sample\_id,\ releases)}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00126}00126\ \ \ \ \ print(\textcolor{stringliteral}{"{}Total\ Releases\ to\ update:\ \{\}"{}}.format(len(request\_upc)))}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00127}00127\ \ \ \ \ \textcolor{comment}{\#\ print(request\_upc)}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00128}00128\ \ \ \ \ \textcolor{comment}{\#\ print(id\_list)}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00129}00129\ \ \ \ \ \textcolor{comment}{\#\ update\_releases(id\_list,\ request\_upc)}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00130}00130\ }
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00131}00131\ \textcolor{keywordflow}{if}\ \_\_name\_\_\ ==\ \textcolor{stringliteral}{'\_\_main\_\_'}:}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00132}\mbox{\hyperlink{namespacesanitization__lines_a73591e0c92fc60d0a8b69d79bbc62b74}{00132}}\ \ \ \ \ options\ =\ \mbox{\hyperlink{namespacesanitization__lines_a392574c6e0a2fca1586c47af3b7b0971}{add\_parser\_options}}()}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00133}\mbox{\hyperlink{namespacesanitization__lines_a8a8ba535761359ca8cb9c2a3f0012181}{00133}}\ \ \ \ \ date\ =\ datetime.datetime.strptime(options.date,\ \textcolor{stringliteral}{"{}\%Y-\/\%m-\/\%d"{}})}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00134}00134\ \ \ \ \ \mbox{\hyperlink{namespacemain}{main}}(options)}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00135}00135\ }
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00136}00136\ \ \ \ \ \textcolor{comment}{\#\ time\ python\ src/importer/catalog/MongoDB/sanitization\_lines.py\ -\/-\/start=0\ -\/-\/end=20\ -\/-\/split=3\ -\/-\/catalog=audiosalad\ -\/-\/date=2022-\/10-\/13}}
\DoxyCodeLine{\Hypertarget{sanitization__lines_8py_source_l00137}00137\ \ \ \ \ \textcolor{comment}{\#\ time\ python3\ sanitization.py\ -\/-\/start=2000000\ -\/-\/end=4000000\ -\/-\/catalog=audiosalad\ -\/-\/date=2022-\/10-\/13}}

\end{DoxyCode}
