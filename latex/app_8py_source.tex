\doxysection{app.\+py}
\hypertarget{app_8py_source}{}\label{app_8py_source}\index{/Users/michellmonroy/Documents/dev-\/glider/glider/catalogue\_api/app.py@{/Users/michellmonroy/Documents/dev-\/glider/glider/catalogue\_api/app.py}}
\mbox{\hyperlink{app_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00001}\mbox{\hyperlink{namespaceapp}{00001}}\ \textcolor{comment}{\#import\ libraries}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00002}00002\ \textcolor{keyword}{from}\ bson.json\_util\ \textcolor{keyword}{import}\ dumps}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00003}00003\ \textcolor{keyword}{from}\ dotenv\ \textcolor{keyword}{import}\ load\_dotenv}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00004}00004\ \textcolor{keyword}{from}\ flask\ \textcolor{keyword}{import}\ Flask,\ request,\ jsonify,\ redirect,\ url\_for,\ flash}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00005}00005\ \textcolor{keyword}{from}\ flask\_cors\ \textcolor{keyword}{import}\ CORS,\ cross\_origin}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00006}00006\ \textcolor{comment}{\#\ from\ flask\_mail\ import\ Mail,\ Message}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00007}00007\ \textcolor{keyword}{from}\ flask\_pymongo\ \textcolor{keyword}{import}\ PyMongo}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00008}00008\ \textcolor{keyword}{from}\ flask\_restx\ \textcolor{keyword}{import}\ Api,\ Resource,\ fields}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00009}00009\ \textcolor{keyword}{import}\ hmac,\ hashlib,\ base64}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00010}00010\ \textcolor{keyword}{import}\ json}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00011}00011\ \textcolor{keyword}{import}\ numpy\ \textcolor{keyword}{as}\ np}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00012}00012\ \textcolor{keyword}{import}\ os}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00013}00013\ \textcolor{keyword}{import}\ ssl}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00014}00014\ \textcolor{keyword}{from}\ os.path\ \textcolor{keyword}{import}\ join,\ dirname}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00015}00015\ \textcolor{keyword}{import}\ requests}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00016}00016\ \textcolor{keyword}{from}\ sendgrid\ \textcolor{keyword}{import}\ SendGridAPIClient}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00017}00017\ \textcolor{keyword}{from}\ sendgrid.helpers.mail\ \textcolor{keyword}{import}\ Mail}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00018}00018\ \textcolor{comment}{\#import\ project\ files}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00019}00019\ \textcolor{keyword}{import}\ services.openplay}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00020}00020\ \textcolor{keyword}{import}\ services.audiosalad}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00021}00021\ \textcolor{keyword}{import}\ services.mapper\_audiosalad}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00022}00022\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00023}00023\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00024}\mbox{\hyperlink{namespaceapp_a675b4ea702c13dc4b8c05f985a25b496}{00024}}\ app\ =\ Flask(\_\_name\_\_)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00025}\mbox{\hyperlink{namespaceapp_ad9d60e80bf017ab8134bdebe276d4ff0}{00025}}\ cors\ =\ CORS(app)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00028}\mbox{\hyperlink{namespaceapp_a4f6539932c83e167669e366f14d835e3}{00028}}\ dotenv\_path\ =\ join(dirname(\_\_file\_\_),\ \textcolor{stringliteral}{'.env'})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00029}00029\ load\_dotenv(dotenv\_path)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00030}00030\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00031}00031\ app.config[\textcolor{stringliteral}{'CORS\_HEADERS'}]\ =\ \textcolor{stringliteral}{'Content-\/Type'}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00033}00033\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00034}\mbox{\hyperlink{namespaceapp_a5f263adad63fdda0ce8ef1b823f34941}{00034}}\ username\ =\ os.environ.get(\textcolor{stringliteral}{'USERNAME\_OPENPLAY'})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00035}00035\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00036}\mbox{\hyperlink{namespaceapp_abde1fa8e3eeaff0de0672e1606b72a02}{00036}}\ password\ =\ os.environ.get(\textcolor{stringliteral}{'PASSWORD\_OPENPLAY'})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00038}\mbox{\hyperlink{namespaceapp_a8779f3c61eff59e49607de730541217b}{00038}}\ mongodb\ =\ os.environ.get(\textcolor{stringliteral}{'MONGO\_RELEASES'})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00039}00039\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00040}00040\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00041}\mbox{\hyperlink{namespaceapp_a7b9bfbd466c994e876199358201d908e}{00041}}\ mongodb\_client\ =\ PyMongo(app,\ uri=mongodb,\ ssl\_cert\_reqs=ssl.CERT\_NONE,\ connect=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00042}00042\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00043}00043\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00044}\mbox{\hyperlink{namespaceapp_a75341a4bc0e8e239f299316136af3466}{00044}}\ db\ =\ mongodb\_client.db}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00045}00045\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00047}\mbox{\hyperlink{namespaceapp_a0aac1cbb8342575f6a19ff1deea9bd74}{00047}}\ api\ =\ Api(app,\ version=\textcolor{stringliteral}{'1.0'},\ title=\textcolor{stringliteral}{'Glider\ API'})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00048}00048\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00049}00049\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00050}\mbox{\hyperlink{namespaceapp_a95d53ea19a5fef79c1e60dde2c1255d8}{00050}}\ model\_sync\ =\ api.model(\textcolor{stringliteral}{'Sync'},\ \{}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00051}00051\ \ \ \ \ \textcolor{stringliteral}{'upc'}:\ fields.String(description=\textcolor{stringliteral}{'Upc\ code'}),}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00052}00052\ \ \ \ \ \textcolor{stringliteral}{'provider'}:\ fields.String(description=\textcolor{stringliteral}{'Provieder\ of\ release\ (openplay,\ audiosalad)'}),}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00053}00053\ \})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00054}00054\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00055}00055\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00056}\mbox{\hyperlink{namespaceapp_a4e3583bf66f7036531c204f79b3c3d0d}{00056}}\ model\_release\ =\ api.model(\textcolor{stringliteral}{'Release\ get\ batch'},\ \{}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00057}00057\ \ \ \ \ \textcolor{stringliteral}{'upcs'}:\ fields.List(fields.String(description=\textcolor{stringliteral}{'Upc\ code'}))}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00058}00058\ \})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00060}00060\ \textcolor{preprocessor}{@cross\_origin()}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00061}00061\ \textcolor{preprocessor}{@api.route('/release')}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00062}00062\ \textcolor{comment}{\#\ @api.route('/')}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00063}\mbox{\hyperlink{classapp_1_1_release}{00063}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classapp_1_1_release}{Release}}(Resource):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00064}00064\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00065}00065\ \textcolor{stringliteral}{\ \ \ \ It\ carries\ out\ for\ a\ single\ one\ release\ searching\ via\ UPC/ISRC}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00066}00066\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00067}00067\ \ \ \ \ \textcolor{preprocessor}{@api.doc(responses=\{'200':\ 'OK'\},\ params=\{'upc':\ 'Code\ UPC\ of\ release'\})}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00068}00068\ \ \ \ \ \textcolor{preprocessor}{@api.doc(responses=\{'200':\ 'OK'\},\ params=\{'isrc':\ 'Code\ ISRC\ of\ track'\})}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00069}\mbox{\hyperlink{classapp_1_1_release_a0c1743ca36d083718001321da765f2b0}{00069}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classapp_1_1_release_a0c1743ca36d083718001321da765f2b0}{get}}(self):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00070}00070\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00071}00071\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Searches\ into\ MongoDB\ the\ release/track\ info\ using\ a\ single\ upc/isrc\ }}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00072}00072\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00073}00073\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Args:}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00074}00074\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ self}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00075}00075\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Returns:\ output\_audiosalad\ (json)}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00076}00076\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00077}00077\ \ \ \ \ \ \ \ \ upc\ =\ request.args.get(\textcolor{stringliteral}{'upc'})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00078}00078\ \ \ \ \ \ \ \ \ isrc\ =\ request.args.get(\textcolor{stringliteral}{'isrc'})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00079}00079\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00080}00080\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ upc\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00081}00081\ \ \ \ \ \ \ \ \ \ \ \ \ release\_audiosalad\ =\ services.audiosalad.get\_release\_by\_upc\_audiosalad(upc)\ \ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00082}00082\ \ \ \ \ \ \ \ \ \ \ \ \ release\_openplay\ =\ services.openplay.get\_release\_by\_upc\_openplay(upc)\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ release\_openplay\ !=\ \textcolor{stringliteral}{'[]'}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay\ =\ json.loads(release\_openplay)[0]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00085}00085\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay\ =\ \{\textcolor{stringliteral}{'upc'}:\ upc,\ \textcolor{stringliteral}{'message'}\ :\ \textcolor{stringliteral}{'Release\ not\ found'},\ \textcolor{stringliteral}{'error'}:\ \textcolor{keyword}{True}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00087}00087\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ release\_audiosalad\ !=\ \textcolor{stringliteral}{'[]'}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad\ =\ json.loads(release\_audiosalad)[0]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00091}00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad\ =\ \{\textcolor{stringliteral}{'upc'}:\ upc,\ \textcolor{stringliteral}{'message'}\ :\ \textcolor{stringliteral}{'Release\ not\ found'},\ \textcolor{stringliteral}{'error'}:\ \textcolor{keyword}{True}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00092}00092\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ release\_audiosalad\ =\ services.audiosalad.get\_release\_by\_isrc\_audiosalad(isrc)\ \ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \ \ \ release\_openplay\ =\ services.openplay.get\_release\_by\_isrc\_openplay(isrc)\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00095}00095\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ release\_openplay\ !=\ \textcolor{stringliteral}{'[]'}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00096}00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay\ =\ json.loads(release\_openplay)[0]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00098}00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay\ =\ \{\textcolor{stringliteral}{'isrc'}:\ isrc,\ \textcolor{stringliteral}{'message'}\ :\ \textcolor{stringliteral}{'Track\ not\ found'},\ \textcolor{stringliteral}{'error'}:\ \textcolor{keyword}{True}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00099}00099\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ release\_audiosalad\ !=\ \textcolor{stringliteral}{'[]'}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00101}00101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad\ =\ json.loads(release\_audiosalad)[0]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00102}00102\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00103}00103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad\ =\ \{\textcolor{stringliteral}{'upc'}:\ upc,\ \textcolor{stringliteral}{'message'}\ :\ \textcolor{stringliteral}{'Track\ not\ found'},\ \textcolor{stringliteral}{'error'}:\ \textcolor{keyword}{True}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00104}00104\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00105}00105\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00106}00106\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ jsonify(\{\textcolor{stringliteral}{"{}data"{}}:\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00107}00107\ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{"{}openplay"{}}:\ output\_openplay,\ \textcolor{stringliteral}{"{}audiosalad"{}}:\ output\_audiosalad\}\})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00108}00108\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00109}00109\ \textcolor{preprocessor}{@cross\_origin()}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00110}00110\ \textcolor{preprocessor}{@api.route('/releases')}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00111}\mbox{\hyperlink{classapp_1_1_releases}{00111}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classapp_1_1_releases}{Releases}}(Resource):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00112}00112\ \ \ \ \ \textcolor{preprocessor}{@api.expect(model\_release)}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00113}\mbox{\hyperlink{classapp_1_1_releases_adc9421db26a10820766222be867b1682}{00113}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classapp_1_1_releases_adc9421db26a10820766222be867b1682}{post}}(self):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00114}00114\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00115}00115\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Replaces\ into\ MongoDB\ the\ release/track\ info\ using\ upc/isrc}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00116}00116\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00117}00117\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Args:}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00118}00118\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ self}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00119}00119\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Returns:\ output\_audiosalad\ (json)}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00120}00120\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00121}00121\ \ \ \ \ \ \ \ \ body\ =\ request.get\_json()}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00122}00122\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00123}00123\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ body.get(\textcolor{stringliteral}{'upcs'})\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00124}00124\ \ \ \ \ \ \ \ \ \ \ \ \ release\_audiosalad\ =\ \ services.audiosalad.get\_list\_releases\_upc\_audiosalad(body[\textcolor{stringliteral}{'upcs'}])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00125}00125\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ release\_openplay\ =\ services.openplay.get\_list\_releases\_upc\_openplay(body['upcs'])}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00126}00126\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00127}00127\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ validate\_openplay\ =\ services.openplay.get\_list\_releases\_openplay\_validate(body['upcs'])}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00128}00128\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ validate\_audiosalad\ =\ services.audiosalad.validate\_release\_existing\_audiosalad(body['upcs'])}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00129}00129\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00130}00130\ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad\ =\ json.loads(release\_audiosalad)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00131}00131\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ output\_openplay\ =\ json.loads(release\_openplay)}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00132}00132\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00133}00133\ \ \ \ \ \ \ \ \ \ \ \ \ val\_ope\ =\ ([])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00134}00134\ \ \ \ \ \ \ \ \ \ \ \ \ release\_openplay\ =\ dumps(\ db.openplay.aggregate([}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00135}00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$match'}:\ \{\ \textcolor{stringliteral}{'upc'}:\ \{\ \textcolor{stringliteral}{'\$in'}:\ body[\textcolor{stringliteral}{'upcs'}]\}\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00136}00136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$group'}:\ \{\textcolor{stringliteral}{'\_id'}:\textcolor{stringliteral}{'\$upc'},\ \textcolor{stringliteral}{'doc'}:\ \{\textcolor{stringliteral}{'\$first'}:\ \textcolor{stringliteral}{'\$\$ROOT'}\}\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00137}00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{"{}\$replaceRoot"{}}:\{\textcolor{stringliteral}{"{}newRoot"{}}:\textcolor{stringliteral}{"{}\$doc"{}}\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00138}00138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$project'}:\ \{\textcolor{stringliteral}{'\_id'}:0\}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00139}00139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00140}00140\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00141}00141\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00142}00142\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00143}00143\ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay\ =\ json.loads(release\_openplay)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00144}00144\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00145}00145\ \ \ \ \ \ \ \ \ \ \ \ \ validate\_openplay\ =\ json.loads(dumps(db.openplay.find(}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00146}00146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{stringliteral}{'upc'}:\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00147}00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{stringliteral}{'\$in'}:\ body[\textcolor{stringliteral}{'upcs'}]\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00148}00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00149}00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\_id'}:\ 0,\ \textcolor{stringliteral}{'upc'}:\ 1\}))}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00150}00150\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00151}00151\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00152}00152\ \ \ \ \ \ \ \ \ \ \ \ \ val\_ope\ =\ ([])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00153}00153\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ element\ \textcolor{keywordflow}{in}\ validate\_openplay\ :\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00154}00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ val\_ope.append([element[\textcolor{stringliteral}{'upc'}]])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00155}00155\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00156}00156\ \ \ \ \ \ \ \ \ \ \ \ \ result\_ope\ =\ np.in1d(body[\textcolor{stringliteral}{'upcs'}],\ val\_ope)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00157}00157\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00158}00158\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ idx,\ val\ \textcolor{keywordflow}{in}\ enumerate(result\_ope):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00159}00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ val\ ==\ \textcolor{keyword}{False}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00160}00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ obj\_err\ =\ \{\textcolor{stringliteral}{'upc'}:\ body[\textcolor{stringliteral}{'upcs'}][idx],\ \textcolor{stringliteral}{'message'}\ :\ \textcolor{stringliteral}{'Release\ not\ found'},\ \textcolor{stringliteral}{'error'}:\ \textcolor{keyword}{True}\}\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00161}00161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay.append(obj\_err)\ \ \ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00162}00162\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00163}00163\ \ \ \ \ \ \ \ \ \ \ \ \ val\_aud\ =\ []}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00164}00164\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ element\ \textcolor{keywordflow}{in}\ output\_audiosalad:\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00165}00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ val\_aud.append(element[\textcolor{stringliteral}{'upc'}])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00166}00166\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00167}00167\ \ \ \ \ \ \ \ \ \ \ \ \ result\_aud\ =\ np.in1d(body[\textcolor{stringliteral}{'upcs'}],\ val\_aud)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00168}00168\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00169}00169\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ idx,\ val\ \textcolor{keywordflow}{in}\ enumerate(result\_aud):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00170}00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ val\ ==\ \textcolor{keyword}{False}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00171}00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ obj\_err\ =\ \{\textcolor{stringliteral}{'upc'}:\ body[\textcolor{stringliteral}{'upcs'}][idx],\ \textcolor{stringliteral}{'message'}\ :\ \textcolor{stringliteral}{'Release\ not\ found'},\ \textcolor{stringliteral}{'error'}:\ \textcolor{keyword}{True}\}\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00172}00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad.append(obj\_err)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00173}00173\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00174}00174\ \ \ \ \ \ \ \ \ \ \ \ \ release\_audiosalad\ =\ \ services.audiosalad.get\_list\_releases\_isrc\_audiosalad(body[\textcolor{stringliteral}{'isrcs'}])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00175}00175\ \ \ \ \ \ \ \ \ \ \ \ \ release\_openplay\ =\ services.openplay.get\_list\_releases\_isrc\_openplay(body[\textcolor{stringliteral}{'isrcs'}])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00176}00176\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00177}00177\ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad\ =\ json.loads(release\_audiosalad)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00178}00178\ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay\ =\ json.loads(release\_openplay)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00179}00179\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00180}00180\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ jsonify(\{\textcolor{stringliteral}{"{}data"{}}:\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00181}00181\ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{"{}openplay"{}}:\ output\_openplay,\ \textcolor{stringliteral}{"{}audiosalad"{}}:\ output\_audiosalad\}\})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00182}00182\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00183}00183\ \textcolor{preprocessor}{@cross\_origin()}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00184}00184\ \textcolor{preprocessor}{@api.route('/sync')}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00185}\mbox{\hyperlink{classapp_1_1_sync}{00185}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classapp_1_1_sync}{Sync}}(Resource):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00186}00186\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00187}00187\ \textcolor{stringliteral}{\ \ \ \ Syncs\ the\ Audiosalad\ catalogue}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00188}00188\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00189}00189\ \ \ \ \ \textcolor{preprocessor}{@api.expect(model\_sync)}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00190}\mbox{\hyperlink{classapp_1_1_sync_ae6776ade802f0d750f42bef2501b3179}{00190}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classapp_1_1_sync_ae6776ade802f0d750f42bef2501b3179}{post}}(self):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00191}00191\ \ \ \ \ \ \ \ \ body\ =\ request.get\_json()}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00192}00192\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00193}00193\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ body[\textcolor{stringliteral}{'provider'}]\ ==\ \textcolor{stringliteral}{'audiosalad'}:\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00194}00194\ \ \ \ \ \ \ \ \ \ \ \ \ release\ =\ services.audiosalad.get\_release\_by\_upc(body[\textcolor{stringliteral}{'upc'}])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00195}00195\ \ \ \ \ \ \ \ \ \ \ \ \ map\ =\ services.mapper\_audiosalad.mapper\_audiosalad\_to\_db(release)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00196}00196\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ if\ s.case('openplay',\ True):\ }}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00197}00197\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ \ \ release\ =\ services.openplay.get\_release\_by\_upc(body['upc'])}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00198}00198\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \ \ \ \ map\ =\ services.mapper\_audiosalad.mapper\_audiosalad\_to\_db(release)}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00199}00199\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ jsonify(\{\textcolor{stringliteral}{'message'}:\ \textcolor{stringliteral}{'Sync\ Success'}\})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00200}00200\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00201}00201\ \textcolor{preprocessor}{@cross\_origin()}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00202}00202\ \textcolor{preprocessor}{@api.route('/v2/release')}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00203}\mbox{\hyperlink{classapp_1_1_release_v2}{00203}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classapp_1_1_release_v2}{ReleaseV2}}(Resource):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00204}00204\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00205}00205\ \textcolor{stringliteral}{\ \ \ \ It\ carries\ out\ for\ several\ releases\ searching\ via\ UPC/ISRC}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00206}00206\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00207}00207\ \ \ \ \ \textcolor{preprocessor}{@api.doc(responses=\{'200':\ 'OK'\},\ params=\{'upc':\ 'Code\ UPC\ of\ release'\})}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00208}00208\ \ \ \ \ \textcolor{preprocessor}{@api.doc(responses=\{'200':\ 'OK'\},\ params=\{'isrc':\ 'Code\ ISRC\ of\ track'\})}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00209}\mbox{\hyperlink{classapp_1_1_release_v2_a764aefc0df00d2f18d667c7d03e09182}{00209}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classapp_1_1_release_v2_a764aefc0df00d2f18d667c7d03e09182}{get}}(self):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00210}00210\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00211}00211\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Searches\ into\ MongoDB\ the\ releases/tracks\ info\ using\ severals\ upc/isrc,\ but\ not\ merge\ upcs\ with\ isrcs}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00212}00212\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00213}00213\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Args:}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00214}00214\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ self}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00215}00215\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Returns:\ output\_audiosalad\ (json)}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00216}00216\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00217}00217\ \ \ \ \ \ \ \ \ upc\ =\ request.args.get(\textcolor{stringliteral}{'upc'})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00218}00218\ \ \ \ \ \ \ \ \ isrc\ =\ request.args.get(\textcolor{stringliteral}{'isrc'})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00219}00219\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00220}00220\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ upc\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00221}00221\ \ \ \ \ \ \ \ \ \ \ \ \ release\_audiosalad\ =\ list(db.audiosalad\_gyro.aggregate([}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00222}00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$match'}:\ \{\textcolor{stringliteral}{'upc'}:\ upc\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00223}00223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$sort'}:\ \{\textcolor{stringliteral}{'id'}:\ -\/1\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00224}00224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$limit'}:\ 1\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00225}00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$project'}:\ \{\textcolor{stringliteral}{'\_id'}:\ 0\ \}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00226}00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00227}00227\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00228}00228\ \ \ \ \ \ \ \ \ \ \ \ \ print(release\_audiosalad)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00229}00229\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ release\_audiosalad\ =\ json.dumps(release\_audiosalad)}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00230}00230\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00231}00231\ \ \ \ \ \ \ \ \ \ \ \ \ release\_openplay\ =\ list(db.openplay.aggregate([}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00232}00232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$match'}:\ \{\textcolor{stringliteral}{'upc'}:\ upc\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00233}00233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$sort'}:\ \{\textcolor{stringliteral}{'\_id'}:\ -\/1\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00234}00234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$limit'}:\ 1\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00235}00235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$project'}:\ \{\textcolor{stringliteral}{'\_id'}:\ 0\ \}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00236}00236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00237}00237\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00238}00238\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(release\_openplay)\ !=\ 0\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00239}00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ output\_openplay\ =\ json.loads(release\_openplay)[0]}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00240}00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay\ =\ release\_openplay[0]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00241}00241\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00242}00242\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay\ =\ \{\textcolor{stringliteral}{'upc'}:\ upc,\ \textcolor{stringliteral}{'message'}\ :\ \textcolor{stringliteral}{'Release\ not\ found'},\ \textcolor{stringliteral}{'error'}:\ \textcolor{keyword}{True}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00243}00243\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00244}00244\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ if\ release\_audiosalad\ !=\ '[]'\ :}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00245}00245\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(release\_audiosalad)\ !=\ 0\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00246}00246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ output\_audiosalad\ =\ json.loads(release\_audiosalad)[0]}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00247}00247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad\ =\ release\_audiosalad[0]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00248}00248\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00249}00249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad\ =\ \{\textcolor{stringliteral}{'upc'}:\ upc,\ \textcolor{stringliteral}{'message'}\ :\ \textcolor{stringliteral}{'Release\ not\ found'},\ \textcolor{stringliteral}{'error'}:\ \textcolor{keyword}{True}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00250}00250\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ release\_openplay\ =\ json.dumps(release\_openplay)}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00251}00251\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00252}00252\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ if\ release\_openplay\ !=\ '[]'\ :}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00253}00253\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00254}00254\ \ \ \ \ \ \ \ \ \ \ \ \ release\_audiosalad\ =\ list(db.audiosalad\_gyro.aggregate([}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00255}00255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$match'}:\ \{\textcolor{stringliteral}{'tracks.isrc'}:\ isrc\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00256}00256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$sort'}:\ \{\textcolor{stringliteral}{'id'}:\ -\/1\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00257}00257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$limit'}:\ 1\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00258}00258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$project'}:\ \{\textcolor{stringliteral}{'\_id'}:\ 0\ \}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00259}00259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00260}00260\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00261}00261\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ release\_audiosalad\ =\ json.dumps(release\_audiosalad)}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00262}00262\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00263}00263\ \ \ \ \ \ \ \ \ \ \ \ \ release\_openplay\ =\ list(db.openplay.aggregate([}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00264}00264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$match'}:\ \{\textcolor{stringliteral}{'tracks.isrc'}:\ isrc\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00265}00265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$sort'}:\ \{\textcolor{stringliteral}{'\_id'}:\ -\/1\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00266}00266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$limit'}:\ 1\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00267}00267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$project'}:\ \{\textcolor{stringliteral}{'\_id'}:\ 0\ \}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00268}00268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00269}00269\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00270}00270\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00271}00271\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(release\_openplay)\ !=\ 0\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00272}00272\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ output\_openplay\ =\ json.loads(release\_openplay)[0]}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00273}00273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay\ =\ release\_openplay[0]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00274}00274\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00275}00275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay\ =\ \{\textcolor{stringliteral}{'isrc'}:\ isrc,\ \textcolor{stringliteral}{'message'}\ :\ \textcolor{stringliteral}{'Track\ not\ found'},\ \textcolor{stringliteral}{'error'}:\ \textcolor{keyword}{True}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00276}00276\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00277}00277\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ if\ release\_audiosalad\ !=\ '[]'\ :}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00278}00278\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(release\_audiosalad)\ !=\ 0\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00279}00279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ output\_audiosalad\ =\ json.loads(release\_audiosalad)[0]}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00280}00280\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad\ =\ release\_audiosalad[0]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00281}00281\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00282}00282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad\ =\ \{\textcolor{stringliteral}{'isrc'}:\ isrc,\ \textcolor{stringliteral}{'message'}\ :\ \textcolor{stringliteral}{'Track\ not\ found'},\ \textcolor{stringliteral}{'error'}:\ \textcolor{keyword}{True}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00283}00283\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00284}00284\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ jsonify(\{\textcolor{stringliteral}{"{}data"{}}:\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00285}00285\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ \{"{}openplay"{}:\ output\_openplay,\ "{}audiosalad"{}:\ output\_audiosalad\}\})}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00286}00286\ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{"{}openplay"{}}:\ output\_openplay,\ \textcolor{stringliteral}{"{}audiosalad"{}}:\ output\_audiosalad\}\})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00287}00287\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00288}00288\ \textcolor{preprocessor}{@cross\_origin}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00289}00289\ \textcolor{preprocessor}{@api.route('/v2/releases')}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00290}\mbox{\hyperlink{classapp_1_1_releases_v2}{00290}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classapp_1_1_releases_v2}{ReleasesV2}}(Resource):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00291}00291\ \ \ \ \ \textcolor{preprocessor}{@api.expect(model\_release)}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00292}\mbox{\hyperlink{classapp_1_1_releases_v2_a1bf1108e760403e9cc18416000882c24}{00292}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classapp_1_1_releases_v2_a1bf1108e760403e9cc18416000882c24}{post}}(self):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00293}00293\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00294}00294\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Replaces\ into\ MongoDB\ the\ releases/tracks\ info\ using\ severals\ upc/isrc,\ but\ not\ merge\ upcs\ with\ isrcs}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00295}00295\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00296}00296\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Args:}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00297}00297\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ self}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00298}00298\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Returns:\ output\_audiosalad\ (json)}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00299}00299\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00300}00300\ \ \ \ \ \ \ \ \ body\ =\ request.get\_json()}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00301}00301\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}upcs"{}}\ \textcolor{keywordflow}{in}\ body:}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00302}00302\ \ \ \ \ \ \ \ \ \ \ \ \ release\_audiosalad\ =\ \ dumps(db.audiosalad\_gyro.aggregate([}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00303}00303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$match'}:\ \{\textcolor{stringliteral}{'upc'}:\ \{\textcolor{stringliteral}{'\$in'}:\ body[\textcolor{stringliteral}{'upcs'}]\}\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00304}00304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$project'}:\ \{\textcolor{stringliteral}{'\_id'}:\ 0\}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00305}00305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00306}00306\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00307}00307\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00308}00308\ \ \ \ \ \ \ \ \ \ \ \ \ release\_openplay\ =\ dumps(\ db.openplay.aggregate([}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00309}00309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$match'}:\ \{\ \textcolor{stringliteral}{'upc'}:\ \{\ \textcolor{stringliteral}{'\$in'}:\ body[\textcolor{stringliteral}{'upcs'}]\}\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00310}00310\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$group'}:\ \{\textcolor{stringliteral}{'\_id'}:\textcolor{stringliteral}{'\$upc'},\ \textcolor{stringliteral}{'doc'}:\ \{\textcolor{stringliteral}{'\$first'}:\ \textcolor{stringliteral}{'\$\$ROOT'}\}\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00311}00311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{"{}\$replaceRoot"{}}:\{\textcolor{stringliteral}{"{}newRoot"{}}:\textcolor{stringliteral}{"{}\$doc"{}}\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00312}00312\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$project'}:\ \{\textcolor{stringliteral}{'\_id'}:0\}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00313}00313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00314}00314\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00315}00315\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00316}00316\ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad\ =\ json.loads(release\_audiosalad)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00317}00317\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ idx\ \textcolor{keywordflow}{in}\ range(len(output\_audiosalad)):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00318}00318\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad[idx][\textcolor{stringliteral}{"{}digital\_release\_date"{}}]\ =\ output\_audiosalad[idx][\textcolor{stringliteral}{"{}releaseDate"{}}]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00319}00319\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad[idx][\textcolor{stringliteral}{"{}display\_artist"{}}]\ =\ output\_audiosalad[idx][\textcolor{stringliteral}{"{}artist"{}}]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00320}00320\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad[idx][\textcolor{stringliteral}{"{}packshot\_medium\_url"{}}]\ =\ output\_audiosalad[idx][\textcolor{stringliteral}{"{}images"{}}][0][\textcolor{stringliteral}{"{}urlMedium"{}}]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00321}00321\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00322}00322\ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay\ =\ json.loads(release\_openplay)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00323}00323\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00324}00324\ \ \ \ \ \ \ \ \ \ \ \ \ validate\_openplay\ =\ json.loads(dumps(db.openplay.find(}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00325}00325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{stringliteral}{'upc'}:\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00326}00326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{stringliteral}{'\$in'}:\ body[\textcolor{stringliteral}{'upcs'}]\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00327}00327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00328}00328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\_id'}:\ 0,\ \textcolor{stringliteral}{'upc'}:\ 1\}))}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00329}00329\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00330}00330\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00331}00331\ \ \ \ \ \ \ \ \ \ \ \ \ val\_ope\ =\ ([])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00332}00332\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ element\ \textcolor{keywordflow}{in}\ validate\_openplay\ :\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00333}00333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ val\_ope.append([element[\textcolor{stringliteral}{'upc'}]])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00334}00334\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00335}00335\ \ \ \ \ \ \ \ \ \ \ \ \ result\_ope\ =\ np.in1d(body[\textcolor{stringliteral}{'upcs'}],\ val\_ope)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00336}00336\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00337}00337\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ idx,\ val\ \textcolor{keywordflow}{in}\ enumerate(result\_ope):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00338}00338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ val\ ==\ \textcolor{keyword}{False}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00339}00339\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ obj\_err\ =\ \{\textcolor{stringliteral}{'upc'}:\ body[\textcolor{stringliteral}{'upcs'}][idx],\ \textcolor{stringliteral}{'message'}\ :\ \textcolor{stringliteral}{'Release\ not\ found'},\ \textcolor{stringliteral}{'error'}:\ \textcolor{keyword}{True}\}\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00340}00340\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay.append(obj\_err)\ \ \ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00341}00341\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00342}00342\ \ \ \ \ \ \ \ \ \ \ \ \ validate\_audiosalad\ =\ json.loads(dumps(db.audiosalad\_gyro.find(}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00343}00343\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{stringliteral}{'upc'}:\ \{\ \textcolor{stringliteral}{'\$in'}:\ body[\textcolor{stringliteral}{'upcs'}]\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00344}00344\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\_id'}:\ 0,\ \textcolor{stringliteral}{'upc'}:\ 1\}))}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00345}00345\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00346}00346\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00347}00347\ \ \ \ \ \ \ \ \ \ \ \ \ val\_aud\ =\ ([])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00348}00348\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ element\ \textcolor{keywordflow}{in}\ validate\_audiosalad\ :\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00349}00349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ val\_aud.append([element[\textcolor{stringliteral}{'upc'}]])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00350}00350\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00351}00351\ \ \ \ \ \ \ \ \ \ \ \ \ result\_aud\ =\ np.in1d(body[\textcolor{stringliteral}{'upcs'}],\ val\_aud)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00352}00352\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00353}00353\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ idx,\ val\ \textcolor{keywordflow}{in}\ enumerate(result\_aud):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00354}00354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ val\ ==\ \textcolor{keyword}{False}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00355}00355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ obj\_err\ =\ \{\textcolor{stringliteral}{'upc'}:\ body[\textcolor{stringliteral}{'upcs'}][idx],\ \textcolor{stringliteral}{'message'}\ :\ \textcolor{stringliteral}{'Release\ not\ found'},\ \textcolor{stringliteral}{'error'}:\ \textcolor{keyword}{True}\}\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00356}00356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad.append(obj\_err)\ \ \ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00357}00357\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00358}00358\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00359}00359\ \ \ \ \ \ \ \ \ \ \ \ \ release\_audiosalad\ =\ \ dumps(db.audiosalad\_gyro.aggregate([}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00360}00360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$match'}:\ \{\textcolor{stringliteral}{'tracks.isrc'}:\ \{\textcolor{stringliteral}{'\$in'}:\ body[\textcolor{stringliteral}{'isrcs'}]\}\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00361}00361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$project'}:\ \{\textcolor{stringliteral}{'\_id'}:\ 0\ \}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00362}00362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00363}00363\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00364}00364\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00365}00365\ \ \ \ \ \ \ \ \ \ \ \ \ release\_openplay\ =\ dumps(\ db.openplay.aggregate([}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00366}00366\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$match'}:\ \{\ \textcolor{stringliteral}{'discs.tracks.isrc'}:\ \{\ \textcolor{stringliteral}{'\$in'}:\ body[\textcolor{stringliteral}{'isrcs'}]\}\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00367}00367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$group'}:\ \{\textcolor{stringliteral}{'\_id'}:\textcolor{stringliteral}{'\$upc'},\ \textcolor{stringliteral}{'doc'}:\ \{\textcolor{stringliteral}{'\$first'}:\ \textcolor{stringliteral}{'\$\$ROOT'}\}\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00368}00368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{"{}\$replaceRoot"{}}:\{\textcolor{stringliteral}{"{}newRoot"{}}:\textcolor{stringliteral}{"{}\$doc"{}}\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00369}00369\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$project'}:\ \{\textcolor{stringliteral}{'\_id'}:0\}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00370}00370\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00371}00371\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00372}00372\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00373}00373\ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad\ =\ json.loads(release\_audiosalad)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00374}00374\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ idx\ \textcolor{keywordflow}{in}\ range(len(output\_audiosalad)):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00375}00375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad[idx][\textcolor{stringliteral}{"{}digital\_release\_date"{}}]\ =\ output\_audiosalad[idx][\textcolor{stringliteral}{"{}releaseDate"{}}]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00376}00376\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad[idx][\textcolor{stringliteral}{"{}display\_artist"{}}]\ =\ output\_audiosalad[idx][\textcolor{stringliteral}{"{}artist"{}}]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00377}00377\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad[idx][\textcolor{stringliteral}{"{}packshot\_medium\_url"{}}]\ =\ output\_audiosalad[idx][\textcolor{stringliteral}{"{}images"{}}][0][\textcolor{stringliteral}{"{}urlMedium"{}}]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00378}00378\ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay\ =\ json.loads(release\_openplay)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00379}00379\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00380}00380\ \ \ \ \ \ \ \ \ \ \ \ \ validate\_openplay\ =\ json.loads(dumps(db.openplay.find(}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00381}00381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{stringliteral}{'discs.tracks.isrc'}:\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00382}00382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{stringliteral}{'\$in'}:\ body[\textcolor{stringliteral}{'isrcs'}]\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00383}00383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00384}00384\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\_id'}:\ 0,\ \textcolor{stringliteral}{'upc'}:\ 1,\ \textcolor{stringliteral}{'discs.tracks.isrc'}:1\}))}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00385}00385\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00386}00386\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00387}00387\ \ \ \ \ \ \ \ \ \ \ \ \ val\_ope\ =\ ([])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00388}00388\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ element\ \textcolor{keywordflow}{in}\ validate\_openplay\ :\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00389}00389\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ val\_ope.append([element['upc']])}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00390}00390\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ element[\textcolor{stringliteral}{"{}discs"{}}]:}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00391}00391\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ j\ \textcolor{keywordflow}{in}\ i[\textcolor{stringliteral}{"{}tracks"{}}]:}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00392}00392\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ val\_ope.append(j[\textcolor{stringliteral}{"{}isrc"{}}])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00393}00393\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00394}00394\ \ \ \ \ \ \ \ \ \ \ \ \ result\_ope\ =\ np.in1d(body[\textcolor{stringliteral}{'isrcs'}],\ val\_ope)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00395}00395\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00396}00396\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ idx,\ val\ \textcolor{keywordflow}{in}\ enumerate(result\_ope):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00397}00397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ val\ ==\ \textcolor{keyword}{False}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00398}00398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ obj\_err\ =\ \{\textcolor{stringliteral}{'isrc'}:\ body[\textcolor{stringliteral}{'isrcs'}][idx],\ \textcolor{stringliteral}{'message'}\ :\ \textcolor{stringliteral}{'Track\ not\ found'},\ \textcolor{stringliteral}{'error'}:\ \textcolor{keyword}{True}\}\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00399}00399\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_openplay.append(obj\_err)\ \ \ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00400}00400\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00401}00401\ \ \ \ \ \ \ \ \ \ \ \ \ validate\_audiosalad\ =\ json.loads(dumps(db.audiosalad\_gyro.find(}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00402}00402\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{stringliteral}{'tracks.isrc'}:\ \{\ \textcolor{stringliteral}{'\$in'}:\ body[\textcolor{stringliteral}{'isrcs'}]\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00403}00403\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\_id'}:\ 0,\ \textcolor{stringliteral}{'upc'}:\ 1,\ \textcolor{stringliteral}{"{}tracks.isrc"{}}:1\}))}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00404}00404\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00405}00405\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00406}00406\ \ \ \ \ \ \ \ \ \ \ \ \ val\_aud\ =\ ([])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00407}00407\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ element\ \textcolor{keywordflow}{in}\ validate\_audiosalad\ :\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00408}00408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ val\_aud.append([element['upc']])}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00409}00409\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ element[\textcolor{stringliteral}{"{}tracks"{}}]:}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00410}00410\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ val\_aud.append([i[\textcolor{stringliteral}{'isrc'}]])}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00411}00411\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00412}00412\ \ \ \ \ \ \ \ \ \ \ \ \ result\_aud\ =\ np.in1d(body[\textcolor{stringliteral}{'isrcs'}],\ val\_aud)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00413}00413\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00414}00414\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ idx,\ val\ \textcolor{keywordflow}{in}\ enumerate(result\_aud):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00415}00415\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ val\ ==\ \textcolor{keyword}{False}\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00416}00416\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ obj\_err\ =\ \{\textcolor{stringliteral}{'isrc'}:\ body[\textcolor{stringliteral}{'isrcs'}][idx],\ \textcolor{stringliteral}{'message'}\ :\ \textcolor{stringliteral}{'Track\ not\ found'},\ \textcolor{stringliteral}{'error'}:\ \textcolor{keyword}{True}\}\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00417}00417\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\_audiosalad.append(obj\_err)\ \ \ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00418}00418\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00419}00419\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ jsonify(\{\textcolor{stringliteral}{"{}data"{}}:\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00420}00420\ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{"{}openplay"{}}:\ output\_openplay,\ \textcolor{stringliteral}{"{}audiosalad"{}}:\ output\_audiosalad\}\})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00421}00421\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00422}00422\ \textcolor{preprocessor}{@cross\_origin}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00423}00423\ \textcolor{preprocessor}{@api.route('/webhook')}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00424}\mbox{\hyperlink{classapp_1_1_webhook}{00424}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classapp_1_1_webhook}{Webhook}}(Resource):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00425}\mbox{\hyperlink{classapp_1_1_webhook_a95e31b0b4337cda84aa1d0f584274fdb}{00425}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classapp_1_1_webhook_a95e31b0b4337cda84aa1d0f584274fdb}{post}}(self):}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00426}00426\ \ \ \ \ \ \ \ \ body\ =\ request.get\_json()}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00427}00427\ \ \ \ \ \ \ \ \ key\ =\ os.environ.get(\textcolor{stringliteral}{'OPENPLAY\_TOKEN'})\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00428}00428\ \ \ \ \ \ \ \ \ signature\ =\ hmac.new(key,\ body,\ hashlib.sha256)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00429}00429\ \ \ \ \ \ \ \ \ signature.hexdigests()}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00430}00430\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00431}00431\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ hmac.compare\_digest(signature,\ request.headers.get(\textcolor{stringliteral}{'Authorization-\/Signature'}))\ :}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00432}00432\ \ \ \ \ \ \ \ \ \ \ \ \ id\ =\ body[\textcolor{stringliteral}{'id'}]}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00433}00433\ \ \ \ \ \ \ \ \ \ \ \ \ url\ =\ \textcolor{stringliteral}{"{}http://connect.secretlyportal.com/v1/releases/"{}}\ +\ id}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00434}00434\ \ \ \ \ \ \ \ \ \ \ \ \ session\ =\ requests.Session()}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00435}00435\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{global}\ username,\ password}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00436}00436\ \ \ \ \ \ \ \ \ \ \ \ \ session.auth\ =\ (username,\ password)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00437}00437\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#sending\ get\ request}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00438}00438\ \ \ \ \ \ \ \ \ \ \ \ \ r\ =\ session.get(url\ =\ url)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00439}00439\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#extracting\ data\ in\ json\ format}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00440}00440\ \ \ \ \ \ \ \ \ \ \ \ \ data\ =\ r.json()}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00441}00441\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ print(data['id'])}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00442}00442\ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ Mail(from\_email=\ \textcolor{stringliteral}{'notifications@ottomate.me'},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00443}00443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_emails=\ \textcolor{stringliteral}{'julian@ottomate.me'},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00444}00444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ subject=\ \textcolor{stringliteral}{'WEBHOOK'},\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00445}00445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ plain\_text\_content=\ \textcolor{stringliteral}{'test\ send\ message,\ with\ python'},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00446}00446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ html\_content=\ \textcolor{stringliteral}{'<strong>\ test\ send\ message,\ with\ python</strong>'})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00447}00447\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ msg\ =\ Message('WEBHOOK',\ recipients=['julian@ottomate.me'])}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00448}00448\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ msg.body\ =\ 'This\ is\ a\ test\ email!'}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00449}00449\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ msg.html\ =\ '<p>This\ is\ a\ test\ email!</p>'}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00450}00450\ \ \ \ \ \ \ \ \ \ \ \ \ key\ =\ os.environ.get(\textcolor{stringliteral}{'SENDGRID\_API\_KEY'})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00451}00451\ \ \ \ \ \ \ \ \ \ \ \ \ print(key)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00452}00452\ \ \ \ \ \ \ \ \ \ \ \ \ sg\ =\ SendGridAPIClient(key)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00453}00453\ \ \ \ \ \ \ \ \ \ \ \ \ sg.send(msg)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00454}00454\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ mail.send(msg)}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00455}00455\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ r.status\_code\ ==\ 200:}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00456}00456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(r.status\_code)}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00457}00457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ db.openplay.update(}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00458}00458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{id:\ id\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00459}00459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'\$set'}:\ \{data\}\},}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00460}00460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{'upsert'}:\ \textcolor{keyword}{True}\}}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00461}00461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00462}00462\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00463}00463\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ jsonify(\{\textcolor{stringliteral}{'message'}:\ \textcolor{stringliteral}{'Success'}\})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00464}00464\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ jsonify(\{\textcolor{stringliteral}{'message'}:\ \textcolor{stringliteral}{'Invalid\ auth'}\}),\ 401}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00465}00465\ }
\DoxyCodeLine{\Hypertarget{app_8py_source_l00466}00466\ \textcolor{keywordflow}{if}\ \_\_name\_\_\ ==\ \textcolor{stringliteral}{"{}\_\_main\_\_"{}}:}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00467}\mbox{\hyperlink{namespaceapp_ab4a362027d4aa3246e0e0f57ebf177b0}{00467}}\ \ \ \ \ app.run(debug=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{app_8py_source_l00468}00468\ \ \ \ \ }

\end{DoxyCode}
